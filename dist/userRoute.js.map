{"version":3,"sources":["../src/userRoute.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { jwtVerify, createRemoteJWKSet } from 'jose'\n\nconst JWKS = createRemoteJWKSet(new URL('/.well-known/jwks.json', process.env.WATSON_AUTH_URL!))\n\ntype WatsonUser = {\n    id: string\n    email: string\n    name: string | null\n    emailVerified: boolean\n}\n\nexport function createUserGET() {\n    return async (request: NextRequest) => {\n        const token = request.cookies.get('access_token')?.value\n\n        if (!token) {\n            return NextResponse.json({ user: null }, { status: 401 })\n        }\n\n        try {\n            const { payload } = await jwtVerify(token, JWKS, {\n                issuer: process.env.WATSON_AUTH_URL\n            })\n\n            const user: WatsonUser = {\n                id: typeof payload.sub === 'string' ? payload.sub : '',\n                email: typeof payload.email === 'string' ? payload.email : '',\n                name: typeof payload.name === 'string' ? payload.name : null,\n                emailVerified: Boolean(payload.emailVerified)\n            }\n\n            return NextResponse.json({ user })\n        } catch (error) {\n            return NextResponse.json({ user: null }, { status: 401 })\n        }\n    }\n}\n"],"mappings":";AAAA,SAAsB,oBAAoB;AAC1C,SAAS,WAAW,0BAA0B;AAE9C,IAAM,OAAO,mBAAmB,IAAI,IAAI,0BAA0B,QAAQ,IAAI,eAAgB,CAAC;AASxF,SAAS,gBAAgB;AAC5B,SAAO,OAAO,YAAyB;AACnC,UAAM,QAAQ,QAAQ,QAAQ,IAAI,cAAc,GAAG;AAEnD,QAAI,CAAC,OAAO;AACR,aAAO,aAAa,KAAK,EAAE,MAAM,KAAK,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC5D;AAEA,QAAI;AACA,YAAM,EAAE,QAAQ,IAAI,MAAM,UAAU,OAAO,MAAM;AAAA,QAC7C,QAAQ,QAAQ,IAAI;AAAA,MACxB,CAAC;AAED,YAAM,OAAmB;AAAA,QACrB,IAAI,OAAO,QAAQ,QAAQ,WAAW,QAAQ,MAAM;AAAA,QACpD,OAAO,OAAO,QAAQ,UAAU,WAAW,QAAQ,QAAQ;AAAA,QAC3D,MAAM,OAAO,QAAQ,SAAS,WAAW,QAAQ,OAAO;AAAA,QACxD,eAAe,QAAQ,QAAQ,aAAa;AAAA,MAChD;AAEA,aAAO,aAAa,KAAK,EAAE,KAAK,CAAC;AAAA,IACrC,SAAS,OAAO;AACZ,aAAO,aAAa,KAAK,EAAE,MAAM,KAAK,GAAG,EAAE,QAAQ,IAAI,CAAC;AAAA,IAC5D;AAAA,EACJ;AACJ;","names":[]}