{"version":3,"sources":["../src/react.tsx","../src/errors.ts","../src/storage.ts","../src/client.ts"],"sourcesContent":["import {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useMemo,\n  useCallback,\n  type ReactNode,\n} from 'react';\nimport { WatsonAuth } from './client';\nimport type { User, WatsonAuthConfig } from './types';\n\ninterface WatsonAuthContextValue {\n  user: User | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  login: (email: string, password: string) => Promise<void>;\n  register: (email: string, password: string, name?: string) => Promise<void>;\n  logout: () => Promise<void>;\n  forgotPassword: (email: string) => Promise<void>;\n  resetPassword: (token: string, newPassword: string) => Promise<void>;\n  verifyEmail: (token: string) => Promise<void>;\n  getAccessToken: () => Promise<string | null>;\n  client: WatsonAuth;\n}\n\nconst WatsonAuthContext = createContext<WatsonAuthContextValue | null>(null);\n\nexport interface WatsonAuthProviderProps extends Omit<WatsonAuthConfig, 'onAuthStateChange'> {\n  children: ReactNode;\n}\n\nexport function WatsonAuthProvider({\n  children,\n  ...config\n}: WatsonAuthProviderProps): ReactNode {\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const client = useMemo(() => {\n    return new WatsonAuth({\n      ...config,\n      onAuthStateChange: (newUser) => {\n        setUser(newUser);\n        setIsLoading(false);\n      },\n    });\n  }, [config.baseUrl, config.appSlug]);\n\n  useEffect(() => {\n    return () => {\n      client.destroy();\n    };\n  }, [client]);\n\n  const login = useCallback(\n    async (email: string, password: string) => {\n      await client.login(email, password);\n    },\n    [client]\n  );\n\n  const register = useCallback(\n    async (email: string, password: string, name?: string) => {\n      await client.register(email, password, name);\n    },\n    [client]\n  );\n\n  const logout = useCallback(async () => {\n    await client.logout();\n  }, [client]);\n\n  const forgotPassword = useCallback(\n    async (email: string) => {\n      await client.forgotPassword(email);\n    },\n    [client]\n  );\n\n  const resetPassword = useCallback(\n    async (token: string, newPassword: string) => {\n      await client.resetPassword(token, newPassword);\n    },\n    [client]\n  );\n\n  const verifyEmail = useCallback(\n    async (token: string) => {\n      await client.verifyEmail(token);\n    },\n    [client]\n  );\n\n  const getAccessToken = useCallback(async () => {\n    return client.getAccessToken();\n  }, [client]);\n\n  const value: WatsonAuthContextValue = useMemo(\n    () => ({\n      user,\n      isLoading,\n      isAuthenticated: user !== null,\n      login,\n      register,\n      logout,\n      forgotPassword,\n      resetPassword,\n      verifyEmail,\n      getAccessToken,\n      client,\n    }),\n    [\n      user,\n      isLoading,\n      login,\n      register,\n      logout,\n      forgotPassword,\n      resetPassword,\n      verifyEmail,\n      getAccessToken,\n      client,\n    ]\n  );\n\n  return (\n    <WatsonAuthContext.Provider value={value}>\n      {children}\n    </WatsonAuthContext.Provider>\n  );\n}\n\nexport function useWatsonAuth(): WatsonAuthContextValue {\n  const context = useContext(WatsonAuthContext);\n  if (!context) {\n    throw new Error('useWatsonAuth must be used within a WatsonAuthProvider');\n  }\n  return context;\n}\n\nexport { WatsonAuth } from './client';\nexport { AuthError } from './errors';\nexport type {\n  User,\n  WatsonAuthConfig,\n  TokenPayload,\n  StorageAdapter,\n  LoginResult,\n  RegisterResult,\n  MessageResult,\n} from './types';\n","export class AuthError extends Error {\n  code: string;\n  details?: object;\n\n  constructor(code: string, message: string, details?: object) {\n    super(message);\n    this.name = 'AuthError';\n    this.code = code;\n    this.details = details;\n    Object.setPrototypeOf(this, AuthError.prototype);\n  }\n\n  static fromResponse(data: { code?: string; message?: string; details?: object }): AuthError {\n    return new AuthError(\n      data.code || 'unknown_error',\n      data.message || 'An unknown error occurred',\n      data.details\n    );\n  }\n}\n","import type { StorageAdapter } from './types';\n\nconst TOKEN_KEY = 'watsonauth_token';\nconst REFRESH_TOKEN_KEY = 'watsonauth_refresh_token';\n\nexport function createMemoryStorage(): StorageAdapter {\n  const store = new Map<string, string>();\n  return {\n    get: (key) => store.get(key) ?? null,\n    set: (key, value) => {\n      store.set(key, value);\n    },\n    remove: (key) => {\n      store.delete(key);\n    },\n  };\n}\n\nexport function createLocalStorage(): StorageAdapter {\n  return {\n    get: (key) => {\n      try {\n        return localStorage.getItem(key);\n      } catch {\n        return null;\n      }\n    },\n    set: (key, value) => {\n      try {\n        localStorage.setItem(key, value);\n      } catch {\n        // Storage may be full or disabled\n      }\n    },\n    remove: (key) => {\n      try {\n        localStorage.removeItem(key);\n      } catch {\n        // Storage may be disabled\n      }\n    },\n  };\n}\n\nexport function createSessionStorage(): StorageAdapter {\n  return {\n    get: (key) => {\n      try {\n        return sessionStorage.getItem(key);\n      } catch {\n        return null;\n      }\n    },\n    set: (key, value) => {\n      try {\n        sessionStorage.setItem(key, value);\n      } catch {\n        // Storage may be full or disabled\n      }\n    },\n    remove: (key) => {\n      try {\n        sessionStorage.removeItem(key);\n      } catch {\n        // Storage may be disabled\n      }\n    },\n  };\n}\n\nexport function resolveStorage(\n  storage: 'memory' | 'localStorage' | 'sessionStorage' | StorageAdapter | undefined\n): StorageAdapter {\n  if (!storage || storage === 'memory') {\n    return createMemoryStorage();\n  }\n  if (storage === 'localStorage') {\n    return createLocalStorage();\n  }\n  if (storage === 'sessionStorage') {\n    return createSessionStorage();\n  }\n  return storage;\n}\n\nexport { TOKEN_KEY, REFRESH_TOKEN_KEY };\n","import { AuthError } from './errors';\nimport { resolveStorage, TOKEN_KEY, REFRESH_TOKEN_KEY } from './storage';\nimport type {\n  WatsonAuthConfig,\n  User,\n  TokenPayload,\n  StorageAdapter,\n  LoginResult,\n  RegisterResult,\n  MessageResult,\n  AuthStateCallback,\n  RedirectOptions,\n  CallbackResult,\n} from './types';\n\nexport class WatsonAuth {\n  private baseUrl: string;\n  private appSlug: string;\n  private autoRefresh: boolean;\n  private refreshThreshold: number;\n  private storage: StorageAdapter;\n  private listeners: Set<AuthStateCallback> = new Set();\n  private refreshTimer: ReturnType<typeof setTimeout> | null = null;\n  private currentUser: User | null = null;\n\n  constructor(config: WatsonAuthConfig) {\n    this.baseUrl = config.baseUrl.replace(/\\/$/, '');\n    this.appSlug = config.appSlug;\n    this.autoRefresh = config.autoRefresh ?? true;\n    this.refreshThreshold = config.refreshThreshold ?? 60;\n    this.storage = resolveStorage(config.storage);\n\n    if (config.onAuthStateChange) {\n      this.listeners.add(config.onAuthStateChange);\n    }\n\n    this.initializeFromStorage();\n  }\n\n  private async initializeFromStorage(): Promise<void> {\n    const token = await this.storage.get(TOKEN_KEY);\n    if (token) {\n      const payload = this.decodeToken(token);\n      if (payload && !this.isTokenExpired(payload)) {\n        this.currentUser = this.payloadToUser(payload);\n        this.scheduleRefresh(payload);\n        this.notifyListeners();\n      } else {\n        await this.tryRefresh();\n      }\n    }\n  }\n\n  private async request<T>(\n    endpoint: string,\n    options: RequestInit = {}\n  ): Promise<T> {\n    const url = `${this.baseUrl}${endpoint}`;\n    const headers: HeadersInit = {\n      'Content-Type': 'application/json',\n      'X-App-Slug': this.appSlug,\n      ...options.headers,\n    };\n\n    const response = await fetch(url, {\n      ...options,\n      headers,\n      credentials: 'include',\n    });\n\n    const data = await response.json();\n\n    if (!response.ok) {\n      throw AuthError.fromResponse(data);\n    }\n\n    return data as T;\n  }\n\n  private decodeToken(token: string): TokenPayload | null {\n    try {\n      const parts = token.split('.');\n      if (parts.length !== 3) return null;\n      const payload = JSON.parse(atob(parts[1]));\n      return payload as TokenPayload;\n    } catch {\n      return null;\n    }\n  }\n\n  private isTokenExpired(payload: TokenPayload): boolean {\n    const now = Math.floor(Date.now() / 1000);\n    return payload.exp <= now;\n  }\n\n  private shouldRefresh(payload: TokenPayload): boolean {\n    const now = Math.floor(Date.now() / 1000);\n    return payload.exp - now <= this.refreshThreshold;\n  }\n\n  private payloadToUser(payload: TokenPayload): User {\n    return {\n      id: payload.sub,\n      email: payload.email,\n      name: payload.name,\n      emailVerified: payload.emailVerified,\n    };\n  }\n\n  private notifyListeners(): void {\n    for (const listener of this.listeners) {\n      listener(this.currentUser);\n    }\n  }\n\n  private scheduleRefresh(payload: TokenPayload): void {\n    if (!this.autoRefresh) return;\n\n    if (this.refreshTimer) {\n      clearTimeout(this.refreshTimer);\n      this.refreshTimer = null;\n    }\n\n    const now = Math.floor(Date.now() / 1000);\n    const refreshAt = payload.exp - this.refreshThreshold;\n    const delay = Math.max(0, (refreshAt - now) * 1000);\n\n    this.refreshTimer = setTimeout(() => {\n      this.tryRefresh();\n    }, delay);\n  }\n\n  private async tryRefresh(): Promise<boolean> {\n    try {\n      const response = await this.request<{ accessToken: string }>(\n        '/api/auth/refresh',\n        { method: 'POST' }\n      );\n\n      await this.storage.set(TOKEN_KEY, response.accessToken);\n      const payload = this.decodeToken(response.accessToken);\n\n      if (payload) {\n        this.currentUser = this.payloadToUser(payload);\n        this.scheduleRefresh(payload);\n        this.notifyListeners();\n        return true;\n      }\n    } catch {\n      await this.clearAuth();\n    }\n    return false;\n  }\n\n  private async clearAuth(): Promise<void> {\n    if (this.refreshTimer) {\n      clearTimeout(this.refreshTimer);\n      this.refreshTimer = null;\n    }\n    await this.storage.remove(TOKEN_KEY);\n    await this.storage.remove(REFRESH_TOKEN_KEY);\n    this.currentUser = null;\n    this.notifyListeners();\n  }\n\n  async login(email: string, password: string): Promise<LoginResult> {\n    const response = await this.request<{ user: User; accessToken: string }>(\n      '/api/auth/login',\n      {\n        method: 'POST',\n        body: JSON.stringify({ email, password }),\n      }\n    );\n\n    await this.storage.set(TOKEN_KEY, response.accessToken);\n    const payload = this.decodeToken(response.accessToken);\n\n    this.currentUser = response.user;\n    if (payload) {\n      this.scheduleRefresh(payload);\n    }\n    this.notifyListeners();\n\n    return {\n      user: response.user,\n      accessToken: response.accessToken,\n    };\n  }\n\n  async register(\n    email: string,\n    password: string,\n    name?: string\n  ): Promise<RegisterResult> {\n    const response = await this.request<{ user: User; message: string }>(\n      '/api/auth/register',\n      {\n        method: 'POST',\n        body: JSON.stringify({ email, password, name }),\n      }\n    );\n\n    return {\n      user: response.user,\n      message: response.message,\n    };\n  }\n\n  async logout(): Promise<void> {\n    try {\n      await this.request('/api/auth/logout', { method: 'POST' });\n    } catch {\n      // Ignore errors on logout\n    }\n    await this.clearAuth();\n  }\n\n  async forgotPassword(email: string): Promise<MessageResult> {\n    return this.request<MessageResult>('/api/auth/forgot-password', {\n      method: 'POST',\n      body: JSON.stringify({ email }),\n    });\n  }\n\n  async resetPassword(token: string, newPassword: string): Promise<MessageResult> {\n    return this.request<MessageResult>('/api/auth/reset-password', {\n      method: 'POST',\n      body: JSON.stringify({ token, password: newPassword }),\n    });\n  }\n\n  async verifyEmail(token: string): Promise<MessageResult> {\n    return this.request<MessageResult>('/api/auth/verify-email', {\n      method: 'POST',\n      body: JSON.stringify({ token }),\n    });\n  }\n\n  async getAccessToken(): Promise<string | null> {\n    const token = await this.storage.get(TOKEN_KEY);\n    if (!token) return null;\n\n    const payload = this.decodeToken(token);\n    if (!payload) return null;\n\n    if (this.isTokenExpired(payload)) {\n      const refreshed = await this.tryRefresh();\n      if (!refreshed) return null;\n      return this.storage.get(TOKEN_KEY);\n    }\n\n    if (this.shouldRefresh(payload)) {\n      this.tryRefresh();\n    }\n\n    return token;\n  }\n\n  getUser(): User | null {\n    return this.currentUser;\n  }\n\n  isAuthenticated(): boolean {\n    return this.currentUser !== null;\n  }\n\n  onAuthStateChange(callback: AuthStateCallback): () => void {\n    this.listeners.add(callback);\n    callback(this.currentUser);\n\n    return () => {\n      this.listeners.delete(callback);\n    };\n  }\n\n  redirectToLogin(options: RedirectOptions): void {\n    const params = new URLSearchParams({\n      app: this.appSlug,\n      redirect_uri: options.redirectUri,\n    });\n\n    if (options.state) {\n      params.set('state', options.state);\n    }\n\n    window.location.href = `${this.baseUrl}/login?${params.toString()}`;\n  }\n\n  async handleCallback(): Promise<CallbackResult> {\n    const params = new URLSearchParams(window.location.search);\n    const token = params.get('token');\n\n    if (token) {\n      await this.storage.set(TOKEN_KEY, token);\n      const payload = this.decodeToken(token);\n\n      if (payload) {\n        this.currentUser = this.payloadToUser(payload);\n        this.scheduleRefresh(payload);\n        this.notifyListeners();\n\n        return {\n          user: this.currentUser,\n          accessToken: token,\n        };\n      }\n    }\n\n    const response = await this.request<{ user: User; accessToken: string }>(\n      '/api/auth/callback',\n      { method: 'POST' }\n    );\n\n    await this.storage.set(TOKEN_KEY, response.accessToken);\n    const payload = this.decodeToken(response.accessToken);\n\n    this.currentUser = response.user;\n    if (payload) {\n      this.scheduleRefresh(payload);\n    }\n    this.notifyListeners();\n\n    return {\n      user: response.user,\n      accessToken: response.accessToken,\n    };\n  }\n\n  destroy(): void {\n    if (this.refreshTimer) {\n      clearTimeout(this.refreshTimer);\n      this.refreshTimer = null;\n    }\n    this.listeners.clear();\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAQO;;;ACRA,IAAM,YAAN,MAAM,mBAAkB,MAAM;AAAA,EAInC,YAAY,MAAc,SAAiB,SAAkB;AAC3D,UAAM,OAAO;AACb,SAAK,OAAO;AACZ,SAAK,OAAO;AACZ,SAAK,UAAU;AACf,WAAO,eAAe,MAAM,WAAU,SAAS;AAAA,EACjD;AAAA,EAEA,OAAO,aAAa,MAAwE;AAC1F,WAAO,IAAI;AAAA,MACT,KAAK,QAAQ;AAAA,MACb,KAAK,WAAW;AAAA,MAChB,KAAK;AAAA,IACP;AAAA,EACF;AACF;;;ACjBA,IAAM,YAAY;AAClB,IAAM,oBAAoB;AAEnB,SAAS,sBAAsC;AACpD,QAAM,QAAQ,oBAAI,IAAoB;AACtC,SAAO;AAAA,IACL,KAAK,CAAC,QAAQ,MAAM,IAAI,GAAG,KAAK;AAAA,IAChC,KAAK,CAAC,KAAK,UAAU;AACnB,YAAM,IAAI,KAAK,KAAK;AAAA,IACtB;AAAA,IACA,QAAQ,CAAC,QAAQ;AACf,YAAM,OAAO,GAAG;AAAA,IAClB;AAAA,EACF;AACF;AAEO,SAAS,qBAAqC;AACnD,SAAO;AAAA,IACL,KAAK,CAAC,QAAQ;AACZ,UAAI;AACF,eAAO,aAAa,QAAQ,GAAG;AAAA,MACjC,QAAQ;AACN,eAAO;AAAA,MACT;AAAA,IACF;AAAA,IACA,KAAK,CAAC,KAAK,UAAU;AACnB,UAAI;AACF,qBAAa,QAAQ,KAAK,KAAK;AAAA,MACjC,QAAQ;AAAA,MAER;AAAA,IACF;AAAA,IACA,QAAQ,CAAC,QAAQ;AACf,UAAI;AACF,qBAAa,WAAW,GAAG;AAAA,MAC7B,QAAQ;AAAA,MAER;AAAA,IACF;AAAA,EACF;AACF;AAEO,SAAS,uBAAuC;AACrD,SAAO;AAAA,IACL,KAAK,CAAC,QAAQ;AACZ,UAAI;AACF,eAAO,eAAe,QAAQ,GAAG;AAAA,MACnC,QAAQ;AACN,eAAO;AAAA,MACT;AAAA,IACF;AAAA,IACA,KAAK,CAAC,KAAK,UAAU;AACnB,UAAI;AACF,uBAAe,QAAQ,KAAK,KAAK;AAAA,MACnC,QAAQ;AAAA,MAER;AAAA,IACF;AAAA,IACA,QAAQ,CAAC,QAAQ;AACf,UAAI;AACF,uBAAe,WAAW,GAAG;AAAA,MAC/B,QAAQ;AAAA,MAER;AAAA,IACF;AAAA,EACF;AACF;AAEO,SAAS,eACd,SACgB;AAChB,MAAI,CAAC,WAAW,YAAY,UAAU;AACpC,WAAO,oBAAoB;AAAA,EAC7B;AACA,MAAI,YAAY,gBAAgB;AAC9B,WAAO,mBAAmB;AAAA,EAC5B;AACA,MAAI,YAAY,kBAAkB;AAChC,WAAO,qBAAqB;AAAA,EAC9B;AACA,SAAO;AACT;;;ACpEO,IAAM,aAAN,MAAiB;AAAA,EAUtB,YAAY,QAA0B;AAJtC,SAAQ,YAAoC,oBAAI,IAAI;AACpD,SAAQ,eAAqD;AAC7D,SAAQ,cAA2B;AAGjC,SAAK,UAAU,OAAO,QAAQ,QAAQ,OAAO,EAAE;AAC/C,SAAK,UAAU,OAAO;AACtB,SAAK,cAAc,OAAO,eAAe;AACzC,SAAK,mBAAmB,OAAO,oBAAoB;AACnD,SAAK,UAAU,eAAe,OAAO,OAAO;AAE5C,QAAI,OAAO,mBAAmB;AAC5B,WAAK,UAAU,IAAI,OAAO,iBAAiB;AAAA,IAC7C;AAEA,SAAK,sBAAsB;AAAA,EAC7B;AAAA,EAEA,MAAc,wBAAuC;AACnD,UAAM,QAAQ,MAAM,KAAK,QAAQ,IAAI,SAAS;AAC9C,QAAI,OAAO;AACT,YAAM,UAAU,KAAK,YAAY,KAAK;AACtC,UAAI,WAAW,CAAC,KAAK,eAAe,OAAO,GAAG;AAC5C,aAAK,cAAc,KAAK,cAAc,OAAO;AAC7C,aAAK,gBAAgB,OAAO;AAC5B,aAAK,gBAAgB;AAAA,MACvB,OAAO;AACL,cAAM,KAAK,WAAW;AAAA,MACxB;AAAA,IACF;AAAA,EACF;AAAA,EAEA,MAAc,QACZ,UACA,UAAuB,CAAC,GACZ;AACZ,UAAM,MAAM,GAAG,KAAK,OAAO,GAAG,QAAQ;AACtC,UAAM,UAAuB;AAAA,MAC3B,gBAAgB;AAAA,MAChB,cAAc,KAAK;AAAA,MACnB,GAAG,QAAQ;AAAA,IACb;AAEA,UAAM,WAAW,MAAM,MAAM,KAAK;AAAA,MAChC,GAAG;AAAA,MACH;AAAA,MACA,aAAa;AAAA,IACf,CAAC;AAED,UAAM,OAAO,MAAM,SAAS,KAAK;AAEjC,QAAI,CAAC,SAAS,IAAI;AAChB,YAAM,UAAU,aAAa,IAAI;AAAA,IACnC;AAEA,WAAO;AAAA,EACT;AAAA,EAEQ,YAAY,OAAoC;AACtD,QAAI;AACF,YAAM,QAAQ,MAAM,MAAM,GAAG;AAC7B,UAAI,MAAM,WAAW,EAAG,QAAO;AAC/B,YAAM,UAAU,KAAK,MAAM,KAAK,MAAM,CAAC,CAAC,CAAC;AACzC,aAAO;AAAA,IACT,QAAQ;AACN,aAAO;AAAA,IACT;AAAA,EACF;AAAA,EAEQ,eAAe,SAAgC;AACrD,UAAM,MAAM,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AACxC,WAAO,QAAQ,OAAO;AAAA,EACxB;AAAA,EAEQ,cAAc,SAAgC;AACpD,UAAM,MAAM,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AACxC,WAAO,QAAQ,MAAM,OAAO,KAAK;AAAA,EACnC;AAAA,EAEQ,cAAc,SAA6B;AACjD,WAAO;AAAA,MACL,IAAI,QAAQ;AAAA,MACZ,OAAO,QAAQ;AAAA,MACf,MAAM,QAAQ;AAAA,MACd,eAAe,QAAQ;AAAA,IACzB;AAAA,EACF;AAAA,EAEQ,kBAAwB;AAC9B,eAAW,YAAY,KAAK,WAAW;AACrC,eAAS,KAAK,WAAW;AAAA,IAC3B;AAAA,EACF;AAAA,EAEQ,gBAAgB,SAA6B;AACnD,QAAI,CAAC,KAAK,YAAa;AAEvB,QAAI,KAAK,cAAc;AACrB,mBAAa,KAAK,YAAY;AAC9B,WAAK,eAAe;AAAA,IACtB;AAEA,UAAM,MAAM,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AACxC,UAAM,YAAY,QAAQ,MAAM,KAAK;AACrC,UAAM,QAAQ,KAAK,IAAI,IAAI,YAAY,OAAO,GAAI;AAElD,SAAK,eAAe,WAAW,MAAM;AACnC,WAAK,WAAW;AAAA,IAClB,GAAG,KAAK;AAAA,EACV;AAAA,EAEA,MAAc,aAA+B;AAC3C,QAAI;AACF,YAAM,WAAW,MAAM,KAAK;AAAA,QAC1B;AAAA,QACA,EAAE,QAAQ,OAAO;AAAA,MACnB;AAEA,YAAM,KAAK,QAAQ,IAAI,WAAW,SAAS,WAAW;AACtD,YAAM,UAAU,KAAK,YAAY,SAAS,WAAW;AAErD,UAAI,SAAS;AACX,aAAK,cAAc,KAAK,cAAc,OAAO;AAC7C,aAAK,gBAAgB,OAAO;AAC5B,aAAK,gBAAgB;AACrB,eAAO;AAAA,MACT;AAAA,IACF,QAAQ;AACN,YAAM,KAAK,UAAU;AAAA,IACvB;AACA,WAAO;AAAA,EACT;AAAA,EAEA,MAAc,YAA2B;AACvC,QAAI,KAAK,cAAc;AACrB,mBAAa,KAAK,YAAY;AAC9B,WAAK,eAAe;AAAA,IACtB;AACA,UAAM,KAAK,QAAQ,OAAO,SAAS;AACnC,UAAM,KAAK,QAAQ,OAAO,iBAAiB;AAC3C,SAAK,cAAc;AACnB,SAAK,gBAAgB;AAAA,EACvB;AAAA,EAEA,MAAM,MAAM,OAAe,UAAwC;AACjE,UAAM,WAAW,MAAM,KAAK;AAAA,MAC1B;AAAA,MACA;AAAA,QACE,QAAQ;AAAA,QACR,MAAM,KAAK,UAAU,EAAE,OAAO,SAAS,CAAC;AAAA,MAC1C;AAAA,IACF;AAEA,UAAM,KAAK,QAAQ,IAAI,WAAW,SAAS,WAAW;AACtD,UAAM,UAAU,KAAK,YAAY,SAAS,WAAW;AAErD,SAAK,cAAc,SAAS;AAC5B,QAAI,SAAS;AACX,WAAK,gBAAgB,OAAO;AAAA,IAC9B;AACA,SAAK,gBAAgB;AAErB,WAAO;AAAA,MACL,MAAM,SAAS;AAAA,MACf,aAAa,SAAS;AAAA,IACxB;AAAA,EACF;AAAA,EAEA,MAAM,SACJ,OACA,UACA,MACyB;AACzB,UAAM,WAAW,MAAM,KAAK;AAAA,MAC1B;AAAA,MACA;AAAA,QACE,QAAQ;AAAA,QACR,MAAM,KAAK,UAAU,EAAE,OAAO,UAAU,KAAK,CAAC;AAAA,MAChD;AAAA,IACF;AAEA,WAAO;AAAA,MACL,MAAM,SAAS;AAAA,MACf,SAAS,SAAS;AAAA,IACpB;AAAA,EACF;AAAA,EAEA,MAAM,SAAwB;AAC5B,QAAI;AACF,YAAM,KAAK,QAAQ,oBAAoB,EAAE,QAAQ,OAAO,CAAC;AAAA,IAC3D,QAAQ;AAAA,IAER;AACA,UAAM,KAAK,UAAU;AAAA,EACvB;AAAA,EAEA,MAAM,eAAe,OAAuC;AAC1D,WAAO,KAAK,QAAuB,6BAA6B;AAAA,MAC9D,QAAQ;AAAA,MACR,MAAM,KAAK,UAAU,EAAE,MAAM,CAAC;AAAA,IAChC,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,cAAc,OAAe,aAA6C;AAC9E,WAAO,KAAK,QAAuB,4BAA4B;AAAA,MAC7D,QAAQ;AAAA,MACR,MAAM,KAAK,UAAU,EAAE,OAAO,UAAU,YAAY,CAAC;AAAA,IACvD,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,YAAY,OAAuC;AACvD,WAAO,KAAK,QAAuB,0BAA0B;AAAA,MAC3D,QAAQ;AAAA,MACR,MAAM,KAAK,UAAU,EAAE,MAAM,CAAC;AAAA,IAChC,CAAC;AAAA,EACH;AAAA,EAEA,MAAM,iBAAyC;AAC7C,UAAM,QAAQ,MAAM,KAAK,QAAQ,IAAI,SAAS;AAC9C,QAAI,CAAC,MAAO,QAAO;AAEnB,UAAM,UAAU,KAAK,YAAY,KAAK;AACtC,QAAI,CAAC,QAAS,QAAO;AAErB,QAAI,KAAK,eAAe,OAAO,GAAG;AAChC,YAAM,YAAY,MAAM,KAAK,WAAW;AACxC,UAAI,CAAC,UAAW,QAAO;AACvB,aAAO,KAAK,QAAQ,IAAI,SAAS;AAAA,IACnC;AAEA,QAAI,KAAK,cAAc,OAAO,GAAG;AAC/B,WAAK,WAAW;AAAA,IAClB;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,UAAuB;AACrB,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,kBAA2B;AACzB,WAAO,KAAK,gBAAgB;AAAA,EAC9B;AAAA,EAEA,kBAAkB,UAAyC;AACzD,SAAK,UAAU,IAAI,QAAQ;AAC3B,aAAS,KAAK,WAAW;AAEzB,WAAO,MAAM;AACX,WAAK,UAAU,OAAO,QAAQ;AAAA,IAChC;AAAA,EACF;AAAA,EAEA,gBAAgB,SAAgC;AAC9C,UAAM,SAAS,IAAI,gBAAgB;AAAA,MACjC,KAAK,KAAK;AAAA,MACV,cAAc,QAAQ;AAAA,IACxB,CAAC;AAED,QAAI,QAAQ,OAAO;AACjB,aAAO,IAAI,SAAS,QAAQ,KAAK;AAAA,IACnC;AAEA,WAAO,SAAS,OAAO,GAAG,KAAK,OAAO,UAAU,OAAO,SAAS,CAAC;AAAA,EACnE;AAAA,EAEA,MAAM,iBAA0C;AAC9C,UAAM,SAAS,IAAI,gBAAgB,OAAO,SAAS,MAAM;AACzD,UAAM,QAAQ,OAAO,IAAI,OAAO;AAEhC,QAAI,OAAO;AACT,YAAM,KAAK,QAAQ,IAAI,WAAW,KAAK;AACvC,YAAMA,WAAU,KAAK,YAAY,KAAK;AAEtC,UAAIA,UAAS;AACX,aAAK,cAAc,KAAK,cAAcA,QAAO;AAC7C,aAAK,gBAAgBA,QAAO;AAC5B,aAAK,gBAAgB;AAErB,eAAO;AAAA,UACL,MAAM,KAAK;AAAA,UACX,aAAa;AAAA,QACf;AAAA,MACF;AAAA,IACF;AAEA,UAAM,WAAW,MAAM,KAAK;AAAA,MAC1B;AAAA,MACA,EAAE,QAAQ,OAAO;AAAA,IACnB;AAEA,UAAM,KAAK,QAAQ,IAAI,WAAW,SAAS,WAAW;AACtD,UAAM,UAAU,KAAK,YAAY,SAAS,WAAW;AAErD,SAAK,cAAc,SAAS;AAC5B,QAAI,SAAS;AACX,WAAK,gBAAgB,OAAO;AAAA,IAC9B;AACA,SAAK,gBAAgB;AAErB,WAAO;AAAA,MACL,MAAM,SAAS;AAAA,MACf,aAAa,SAAS;AAAA,IACxB;AAAA,EACF;AAAA,EAEA,UAAgB;AACd,QAAI,KAAK,cAAc;AACrB,mBAAa,KAAK,YAAY;AAC9B,WAAK,eAAe;AAAA,IACtB;AACA,SAAK,UAAU,MAAM;AAAA,EACvB;AACF;;;AHhNI;AArGJ,IAAM,wBAAoB,4BAA6C,IAAI;AAMpE,SAAS,mBAAmB;AAAA,EACjC;AAAA,EACA,GAAG;AACL,GAAuC;AACrC,QAAM,CAAC,MAAM,OAAO,QAAI,uBAAsB,IAAI;AAClD,QAAM,CAAC,WAAW,YAAY,QAAI,uBAAS,IAAI;AAE/C,QAAM,aAAS,sBAAQ,MAAM;AAC3B,WAAO,IAAI,WAAW;AAAA,MACpB,GAAG;AAAA,MACH,mBAAmB,CAAC,YAAY;AAC9B,gBAAQ,OAAO;AACf,qBAAa,KAAK;AAAA,MACpB;AAAA,IACF,CAAC;AAAA,EACH,GAAG,CAAC,OAAO,SAAS,OAAO,OAAO,CAAC;AAEnC,8BAAU,MAAM;AACd,WAAO,MAAM;AACX,aAAO,QAAQ;AAAA,IACjB;AAAA,EACF,GAAG,CAAC,MAAM,CAAC;AAEX,QAAM,YAAQ;AAAA,IACZ,OAAO,OAAe,aAAqB;AACzC,YAAM,OAAO,MAAM,OAAO,QAAQ;AAAA,IACpC;AAAA,IACA,CAAC,MAAM;AAAA,EACT;AAEA,QAAM,eAAW;AAAA,IACf,OAAO,OAAe,UAAkB,SAAkB;AACxD,YAAM,OAAO,SAAS,OAAO,UAAU,IAAI;AAAA,IAC7C;AAAA,IACA,CAAC,MAAM;AAAA,EACT;AAEA,QAAM,aAAS,0BAAY,YAAY;AACrC,UAAM,OAAO,OAAO;AAAA,EACtB,GAAG,CAAC,MAAM,CAAC;AAEX,QAAM,qBAAiB;AAAA,IACrB,OAAO,UAAkB;AACvB,YAAM,OAAO,eAAe,KAAK;AAAA,IACnC;AAAA,IACA,CAAC,MAAM;AAAA,EACT;AAEA,QAAM,oBAAgB;AAAA,IACpB,OAAO,OAAe,gBAAwB;AAC5C,YAAM,OAAO,cAAc,OAAO,WAAW;AAAA,IAC/C;AAAA,IACA,CAAC,MAAM;AAAA,EACT;AAEA,QAAM,kBAAc;AAAA,IAClB,OAAO,UAAkB;AACvB,YAAM,OAAO,YAAY,KAAK;AAAA,IAChC;AAAA,IACA,CAAC,MAAM;AAAA,EACT;AAEA,QAAM,qBAAiB,0BAAY,YAAY;AAC7C,WAAO,OAAO,eAAe;AAAA,EAC/B,GAAG,CAAC,MAAM,CAAC;AAEX,QAAM,YAAgC;AAAA,IACpC,OAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA,iBAAiB,SAAS;AAAA,MAC1B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,IACA;AAAA,MACE;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAEA,SACE,4CAAC,kBAAkB,UAAlB,EAA2B,OACzB,UACH;AAEJ;AAEO,SAAS,gBAAwC;AACtD,QAAM,cAAU,yBAAW,iBAAiB;AAC5C,MAAI,CAAC,SAAS;AACZ,UAAM,IAAI,MAAM,wDAAwD;AAAA,EAC1E;AACA,SAAO;AACT;","names":["payload"]}